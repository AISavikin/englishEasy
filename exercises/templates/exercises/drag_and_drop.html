{% extends 'base.html' %}
{% block title %}–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –±—É–∫–≤ (Drag and Drop){% endblock %}

{% block extra_style %}
    <style>
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –±—É–∫–≤ */
        .drop-zone {
            width: 70px;
            height: 80px;
            border: 3px dashed #dee2e6;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 0 10px;
            font-size: 28px;
            font-weight: bold;
            background-color: #f8f9fa;
            transition: all 0.3s;
            user-select: none;
            position: relative;
        }

        .drop-zone.active {
            border-color: #0d6efd;
            background-color: rgba(13, 110, 253, 0.1);
        }

        .drop-zone.filled {
            border-style: solid;
            border-color: #6c757d;
            background-color: white;
        }

        .drop-zone.correct {
            border-color: #198754;
            background-color: rgba(25, 135, 84, 0.1);
        }

        .drop-zone.incorrect {
            border-color: #dc3545;
            background-color: rgba(220, 53, 69, 0.1);
        }

        /* –ü—É–ª –±—É–∫–≤ */
        .letter-pool {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            padding: 25px;
            background-color: #f8f9fa;
            border-radius: 15px;
            min-height: 100px;
        }

        .draggable-letter {
            width: 70px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            background-color: #0d6efd;
            color: white;
            border-radius: 10px;
            cursor: grab;
            user-select: none;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .draggable-letter:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
            background-color: #0b5ed7;
        }

        .draggable-letter:active {
            cursor: grabbing;
            transform: translateY(0);
        }

        .draggable-letter.used {
            opacity: 0.4;
            cursor: not-allowed;
            background-color: #6c757d;
            box-shadow: none;
        }

        .draggable-letter.used:hover {
            transform: none;
            box-shadow: none;
        }

        /* –ë—É–∫–≤–∞ –≤–Ω—É—Ç—Ä–∏ drop-–∑–æ–Ω—ã */
        .letter-in-zone {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            border-radius: 8px;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ª–æ–≤–∞ */
        .word-container {
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
        }

        .russian-word {
            font-size: 2.5rem;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 40px;
            color: #2c3e50;
            text-align: center;
        }

        .drop-zones-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
            padding: 20px;
        }

        .progress-container {
            position: sticky;
            top: 0;
            background: white;
            z-index: 100;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* –ü–æ–¥—Å–∫–∞–∑–∫–∏ */
        .hint {
            font-size: 0.9rem;
            color: #6c757d;
            text-align: center;
            margin-top: 10px;
        }

        .stats-container .card {
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .stats-container .card-header {
            border-bottom: 2px solid #f8f9fa;
        }

        .stats-container .h3 {
            font-weight: bold;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes shake {
            0%, 100% {
                transform: translateX(0);
            }
            25% {
                transform: translateX(-5px);
            }
            75% {
                transform: translateX(5px);
            }
        }

        .shake {
            animation: shake 0.3s ease-in-out;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }

        .pulse {
            animation: pulse 0.5s ease-in-out;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è */
        .exercise-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .exercise-subtitle {
            color: #6c757d;
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É—Å–ø–µ—Ö–∞ –∏ –Ω–µ—É–¥–∞—á–∏ */
        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes success-particle {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }

        @keyframes sad-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes failure-drop {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(50px);
                opacity: 0;
            }
        }

        @keyframes success-pulse {
            0% {
                background-color: rgba(76, 175, 80, 0.1);
            }
            50% {
                background-color: rgba(76, 175, 80, 0.3);
            }
            100% {
                background-color: transparent;
            }
        }

        @keyframes failure-shake {
            0%, 100% {
                background-color: transparent;
            }
            25% {
                background-color: rgba(255, 68, 68, 0.1);
            }
            50% {
                background-color: rgba(255, 68, 68, 0.2);
            }
            75% {
                background-color: rgba(255, 68, 68, 0.1);
            }
        }

        .success-animation {
            animation: success-pulse 0.5s ease-in-out;
        }

        .failure-animation {
            animation: failure-shake 0.5s ease-in-out;
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è drag-and-drop */
        .draggable-letter.correct {
            box-shadow: 0 0 15px rgba(25, 135, 84, 0.5);
            background-color: #198754;
        }

        .draggable-letter.incorrect {
            box-shadow: 0 0 15px rgba(220, 53, 69, 0.5);
            background-color: #dc3545;
        }

        .letter-in-zone.correct {
            background-color: #198754;
            color: white;
            box-shadow: 0 0 10px rgba(25, 135, 84, 0.3);
        }

        .letter-in-zone.incorrect {
            background-color: #dc3545;
            color: white;
            box-shadow: 0 0 10px rgba(220, 53, 69, 0.3);
        }
    </style>
{% endblock %}

{% block content %}
    <div class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è -->
        <div class="row mb-4">
            <div class="col">
                <div class="exercise-title">
                    {% if exercise.description %}
                        {{ exercise.description }}
                    {% else %}
                        –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –±—É–∫–≤ (Drag and Drop)
                    {% endif %}
                </div>
                <div class="exercise-subtitle">
                    –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –±—É–∫–≤—ã, —á—Ç–æ–±—ã —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–ª–æ–≤–∞
                    {% if exercise.due_date %}
                        <span class="badge bg-warning ms-2">
                        –°—Ä–æ–∫: {{ exercise.due_date|date:"d.m.Y H:i" }}
                    </span>
                    {% endif %}
                </div>
            </div>
            <div class="col-auto">
                <div class="badge bg-primary fs-6">
                    {{ exercise.get_assignment_type_display }}
                </div>
            </div>
        </div>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
        <div class="progress-container mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –±—É–∫–≤ (Drag and Drop)</h4>
                <div>
                    <span id="current-word" class="badge bg-primary fs-6">1</span> –∏–∑
                    <span id="total-words" class="badge bg-secondary fs-6">{{ pairs|length }}</span>
                </div>
            </div>
            <div class="progress mt-2" style="height: 8px;">
                <div id="exercise-progress" class="progress-bar" style="width: 0%"></div>
            </div>
        </div>
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-container mb-4">
            <div class="card">
                <div class="card-header bg-light">
                    <h6 class="mb-0">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-4">
                            <div class="h3 mb-1" id="total-attempts">0</div>
                            <small class="text-muted">–í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫</small>
                        </div>
                        <div class="col-4">
                            <div class="h3 mb-1 text-success" id="correct-answers">0</div>
                            <small class="text-muted">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</small>
                        </div>
                        <div class="col-4">
                            <div class="h3 mb-1 text-danger" id="wrong-answers">0</div>
                            <small class="text-muted">–û—à–∏–±–∫–∏</small>
                        </div>
                    </div>
                    <div class="row text-center mt-2">
                        <div class="col-12">
                            <small class="text-muted">–¢–µ–∫—É—â–µ–µ —Å–ª–æ–≤–æ: <span id="current-word-attempts">0</span>
                                –ø–æ–ø—ã—Ç–æ–∫</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è -->
        <div class="card shadow">
            <div class="card-body">
                <div id="word-container" class="word-container">
                    <!-- –†—É—Å—Å–∫–æ–µ —Å–ª–æ–≤–æ -->
                    <div id="current-russian" class="russian-word mb-4"></div>

                    <!-- –û–∫–æ—à–∫–∏ –¥–ª—è –±—É–∫–≤ -->
                    <div class="hint">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –±—É–∫–≤—ã –≤ –æ–∫–æ—à–∫–∏ –Ω–∏–∂–µ, —á—Ç–æ–±—ã —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ —Å–ª–æ–≤–æ</div>
                    <div id="drop-zones" class="drop-zones-container mb-4"></div>

                    <!-- –ü—É–ª –±—É–∫–≤ -->
                    <div class="hint">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –±—É–∫–≤—ã:</div>
                    <div id="letter-pool" class="letter-pool mb-4"></div>

                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
                    <div id="result-message" class="alert d-none mb-4"></div>

                    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                    <div class="mt-4">
                        <button id="check-btn" class="btn btn-primary btn-lg me-3">
                            <i class="bi bi-check-circle me-2"></i>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                        </button>
                        <button id="reset-btn" class="btn btn-outline-secondary btn-lg me-3">
                            <i class="bi bi-arrow-clockwise me-2"></i>–°–±—Ä–æ—Å–∏—Ç—å
                        </button>
                        <button id="next-btn" class="btn btn-success btn-lg d-none">
                            <i class="bi bi-arrow-right me-2"></i>–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ
                        </button>
                        <button id="finish-btn" class="btn btn-success btn-lg d-none">
                            <i class="bi bi-check-circle-fill me-2"></i>–ó–∞–≤–µ—Ä—à–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ -->
    <input type="hidden" id="exercise-id" value="{{ exercise.id }}">
    <input type="hidden" id="current-index" value="0">

    <script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let pairs = {{ pairs|safe }};
let currentIndex = 0;
let totalWords = pairs.length;
let draggedLetter = null;
let startTime;  // –î–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è response_time

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
let totalAttempts = 0;
let correctAnswers = 0;
let wrongAnswers = 0;
let currentWordAttempts = 0;

// –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–π
let successAnimationInterval;
let failureAnimationInterval;
let successParticlesInterval;
let failureDropsInterval;

console.log('Drag & Drop: pairs:', pairs);  // –û—Ç–ª–∞–¥–∫–∞

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    if (pairs.length === 0) {
        showNoWordsMessage();
        return;
    }

    initDragAndDrop();
    loadWord(0);
    updateProgress();
    updateWordCounter();
    updateStats();  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

    // –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    if (!document.getElementById('current-russian')) console.error('–≠–ª–µ–º–µ–Ω—Ç current-russian –Ω–µ –Ω–∞–π–¥–µ–Ω');
    if (!document.getElementById('drop-zones')) console.error('–≠–ª–µ–º–µ–Ω—Ç drop-zones –Ω–µ –Ω–∞–π–¥–µ–Ω');
    if (!document.getElementById('letter-pool')) console.error('–≠–ª–µ–º–µ–Ω—Ç letter-pool –Ω–µ –Ω–∞–π–¥–µ–Ω');
    if (!document.getElementById('check-btn')) console.error('–≠–ª–µ–º–µ–Ω—Ç check-btn –Ω–µ –Ω–∞–π–¥–µ–Ω');
});

function showNoWordsMessage() {
    const container = document.getElementById('word-container');
    if (container) {
        container.innerHTML = `
            <div class="text-center py-5">
                <i class="bi bi-exclamation-triangle display-1 text-warning mb-3"></i>
                <h3>–ù–µ—Ç —Å–ª–æ–≤ –¥–ª—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h3>
                <p class="text-muted">–í —ç—Ç–æ–º —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–∏ –Ω–µ—Ç —Å–ª–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.</p>
                <a href="{% url 'exercises:my_exercises' %}" class="btn btn-primary mt-3">
                    –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
                </a>
            </div>
        `;
    }
}

function initDragAndDrop() {
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –±—É–∫–≤
    document.addEventListener('dragstart', function(e) {
        if (e.target.classList.contains('draggable-letter') && !e.target.classList.contains('used')) {
            draggedLetter = e.target;
            e.dataTransfer.setData('text/plain', e.target.id);
            e.dataTransfer.effectAllowed = 'move';
            e.target.style.opacity = '0.5';
        }
    });

    document.addEventListener('dragend', function(e) {
        if (e.target.classList.contains('draggable-letter')) {
            e.target.style.opacity = '1';
            draggedLetter = null;
        }
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è drop-–∑–æ–Ω
    const dropZonesContainer = document.getElementById('drop-zones');
    if (dropZonesContainer) {
        dropZonesContainer.addEventListener('dragover', function(e) {
            e.preventDefault();
            if (e.target.classList.contains('drop-zone')) {
                e.target.classList.add('active');
                e.dataTransfer.dropEffect = 'move';
            }
        });

        dropZonesContainer.addEventListener('dragleave', function(e) {
            if (e.target.classList.contains('drop-zone')) {
                e.target.classList.remove('active');
            }
        });

        dropZonesContainer.addEventListener('drop', function(e) {
            e.preventDefault();
            e.target.classList.remove('active');

            if (e.target.classList.contains('drop-zone') && draggedLetter) {
                const dropZone = e.target;
                const letterId = e.dataTransfer.getData('text/plain');
                const letterElement = document.getElementById(letterId);

                if (letterElement && !letterElement.classList.contains('used')) {
                    // –ï—Å–ª–∏ –≤ –∑–æ–Ω–µ —É–∂–µ –µ—Å—Ç—å –±—É–∫–≤–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –ø—É–ª
                    const existingLetter = dropZone.querySelector('.draggable-letter');
                    if (existingLetter) {
                        returnLetterToPool(existingLetter);
                    }

                    // –ü–æ–º–µ—â–∞–µ–º –Ω–æ–≤—É—é –±—É–∫–≤—É
                    placeLetterInZone(letterElement, dropZone);

                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    dropZone.classList.add('pulse');
                    setTimeout(() => {
                        dropZone.classList.remove('pulse');
                    }, 500);

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å
                    checkAllZonesFilled();
                }
            }
        });
    }
}

function loadWord(index) {
    if (index >= pairs.length) {
        finishExercise();
        return;
    }

    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞
    stopAllAnimations();

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞
    currentWordAttempts = 0;
    updateCurrentWordStats();

    const word = pairs[index];
    const russianElement = document.getElementById('current-russian');
    if (russianElement) russianElement.textContent = word.russian.toUpperCase();

    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
    const dropZones = document.getElementById('drop-zones');
    if (dropZones) dropZones.innerHTML = '';
    const letterPool = document.getElementById('letter-pool');
    if (letterPool) letterPool.innerHTML = '';

    // –°–æ–∑–¥–∞–µ–º drop-–∑–æ–Ω—ã
    const englishWord = word.english.toUpperCase();
    for (let i = 0; i < englishWord.length; i++) {
        const dropZone = document.createElement('div');
        dropZone.className = 'drop-zone';
        dropZone.dataset.index = i;
        dropZone.dataset.expected = englishWord[i];
        dropZone.dataset.position = i;
        dropZone.setAttribute('draggable', 'false');
        if (dropZones) dropZones.appendChild(dropZone);

        // –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
        dropZone.addEventListener('dblclick', function() {
            const letter = this.querySelector('.draggable-letter');
            if (letter) {
                returnLetterToPool(letter);
                checkAllZonesFilled();
            }
        });
    }

    // –°–æ–∑–¥–∞–µ–º –±—É–∫–≤—ã (—Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º–∏)
    let letters = englishWord.split('');
    const randomLetters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    for (let i = 0; i < Math.min(englishWord.length, 3); i++) {
        const randomLetter = randomLetters[Math.floor(Math.random() * randomLetters.length)];
        letters.push(randomLetter);
    }
    shuffleArray(letters);

    letters.forEach((letter, i) => {
        const letterElement = document.createElement('div');
        letterElement.id = `letter-${index}-${i}`;
        letterElement.className = 'draggable-letter';
        letterElement.draggable = true;
        letterElement.textContent = letter;
        letterElement.dataset.letter = letter;
        if (letterPool) letterPool.appendChild(letterElement);
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
    const checkBtn = document.getElementById('check-btn');
    if (checkBtn) checkBtn.classList.remove('d-none');
    const resetBtn = document.getElementById('reset-btn');
    if (resetBtn) resetBtn.classList.remove('d-none');
    const nextBtn = document.getElementById('next-btn');
    if (nextBtn) nextBtn.classList.add('d-none');
    const finishBtn = document.getElementById('finish-btn');
    if (finishBtn) finishBtn.classList.add('d-none');
    const resultMsg = document.getElementById('result-message');
    if (resultMsg) resultMsg.classList.add('d-none');

    // –£–¥–∞–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –∞–Ω–∏–º–∞—Ü–∏–π –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
    document.querySelectorAll('.success-effect, .failure-effect, .confetti, .sad-face').forEach(el => el.remove());

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ–Ω
    document.body.classList.remove('success-animation', 'failure-animation');

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
    startTime = performance.now();
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function placeLetterInZone(letterElement, dropZone) {
    const clonedLetter = letterElement.cloneNode(true);
    clonedLetter.id = `${letterElement.id}-in-zone`;
    clonedLetter.classList.add('used');
    clonedLetter.classList.remove('draggable-letter');
    clonedLetter.classList.add('letter-in-zone');
    clonedLetter.style.backgroundColor = '#0d6efd';
    clonedLetter.style.opacity = '1';
    clonedLetter.draggable = false;

    clonedLetter.addEventListener('dblclick', function() {
        returnLetterToPool(letterElement);
        dropZone.classList.remove('filled');
        dropZone.innerHTML = '';
        checkAllZonesFilled();
    });

    letterElement.classList.add('used');
    letterElement.style.opacity = '0.4';
    letterElement.style.cursor = 'not-allowed';

    dropZone.innerHTML = '';
    dropZone.appendChild(clonedLetter);
    dropZone.classList.add('filled');
}

function returnLetterToPool(letterElement) {
    const originalId = letterElement.id.replace('-in-zone', '');
    const originalLetter = document.getElementById(originalId);
    if (originalLetter) {
        originalLetter.classList.remove('used');
        originalLetter.style.opacity = '1';
        originalLetter.style.cursor = 'grab';
    }
}

function checkAllZonesFilled() {
    const dropZones = document.querySelectorAll('.drop-zone');
    const allFilled = Array.from(dropZones).every(zone => zone.classList.contains('filled'));

    const checkBtn = document.getElementById('check-btn');
    if (allFilled) {
        if (checkBtn) {
            checkBtn.classList.remove('btn-primary');
            checkBtn.classList.add('btn-success');
        }
    } else {
        if (checkBtn) {
            checkBtn.classList.remove('btn-success');
            checkBtn.classList.add('btn-primary');
        }
    }
}

function checkWord() {
    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫–∏ –ø–æ–ø—ã—Ç–æ–∫
    totalAttempts++;
    currentWordAttempts++;

    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    stopAllAnimations();

    const dropZones = document.querySelectorAll('.drop-zone');
    let allCorrect = true;

    dropZones.forEach(zone => {
        const letterElement = zone.querySelector('.letter-in-zone');
        const userLetter = letterElement ? letterElement.textContent : '';
        const expectedLetter = zone.dataset.expected;

        if (userLetter === expectedLetter) {
            zone.classList.remove('incorrect', 'shake');
            zone.classList.add('correct');
            if (letterElement) {
                letterElement.classList.add('correct');
                letterElement.classList.remove('incorrect');
            }
        } else {
            zone.classList.remove('correct');
            zone.classList.add('incorrect', 'shake');
            if (letterElement) {
                letterElement.classList.add('incorrect');
                letterElement.classList.remove('correct');
            }
            allCorrect = false;
        }
    });

    setTimeout(() => {
        document.querySelectorAll('.shake').forEach(el => el.classList.remove('shake'));
    }, 300);

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    if (allCorrect) {
        correctAnswers++;
        showResultMessage(true, pairs[currentIndex].english.toUpperCase());
    } else {
        wrongAnswers++;
        showResultMessage(false, pairs[currentIndex].english.toUpperCase());
    }

    updateStats();
    updateCurrentWordStats();

    // –í—ã—á–∏—Å–ª—è–µ–º response_time
    const endTime = performance.now();
    const responseTime = (endTime - startTime) / 1000;

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX
    const word = pairs[currentIndex];
    fetch("{% url 'exercises:update_word_stat' exercise.id %}", {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: new URLSearchParams({
            word_id: word.word_id,
            is_correct: allCorrect,
            response_time: responseTime
        })
    })
    .then(response => response.json())
    .then(data => {
        if (!data.success) {
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', data.error);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
    });
}

function showResultMessage(isCorrect, correctWord) {
    const resultMessage = document.getElementById('result-message');

    if (isCorrect) {
        resultMessage.className = 'alert alert-success';
        resultMessage.innerHTML = `
            <i class="bi bi-check-circle-fill me-2"></i>
            <strong>–û—Ç–ª–∏—á–Ω–æ!</strong> –°–ª–æ–≤–æ "${correctWord}" —Å–æ–±—Ä–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ!
        `;

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —É—Å–ø–µ—Ö–∞
        startSuccessAnimation();

        document.getElementById('check-btn').classList.add('d-none');
        document.getElementById('reset-btn').classList.add('d-none');
        document.getElementById('next-btn').classList.remove('d-none');
    } else {
        resultMessage.className = 'alert alert-danger';
        resultMessage.innerHTML = `
            <i class="bi bi-x-circle-fill me-2"></i>
            <strong>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!</strong> –°–ª–æ–≤–æ —Å–æ–±—Ä–∞–Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.
        `;

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –Ω–µ—É–¥–∞—á–∏
        startFailureAnimation();
    }

    resultMessage.classList.remove('d-none');
}

function resetWord() {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
    stopAllAnimations();

    const dropZones = document.querySelectorAll('.drop-zone');
    const letterPool = document.getElementById('letter-pool');

    dropZones.forEach(zone => {
        const letterElement = zone.querySelector('.letter-in-zone');
        if (letterElement) {
            const originalId = letterElement.id.replace('-in-zone', '');
            const originalLetter = document.getElementById(originalId);
            if (originalLetter) {
                originalLetter.classList.remove('used');
                originalLetter.style.opacity = '1';
                originalLetter.style.cursor = 'grab';
            }
        }
        zone.classList.remove('filled', 'correct', 'incorrect', 'active');
        zone.innerHTML = '';
    });

    const letters = Array.from(letterPool.querySelectorAll('.draggable-letter'));
    letterPool.innerHTML = '';
    shuffleArray(letters);
    letters.forEach(letter => letterPool.appendChild(letter));

    const checkBtn = document.getElementById('check-btn');
    if (checkBtn) {
        checkBtn.classList.remove('btn-success');
        checkBtn.classList.add('btn-primary');
    }
    const resultMsg = document.getElementById('result-message');
    if (resultMsg) resultMsg.classList.add('d-none');

    // –£–¥–∞–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã –∞–Ω–∏–º–∞—Ü–∏–π
    document.querySelectorAll('.success-effect, .failure-effect, .confetti, .sad-face, .particle').forEach(el => el.remove());

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ–Ω
    document.body.classList.remove('success-animation', 'failure-animation');
}

function nextWord() {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏
    stopAllAnimations();

    currentIndex++;
    loadWord(currentIndex);
    updateProgress();
    updateWordCounter();
}

function finishExercise() {
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    stopAllAnimations();

    const container = document.getElementById('word-container');
    container.innerHTML = `
        <div class="text-center py-5">
            <i class="bi bi-check-circle-fill display-1 text-success mb-3"></i>
            <h3>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!</h3>
            <p class="text-muted">–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è.</p>
            <div class="row mt-4">
                <div class="col-md-6 offset-md-3">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h5>–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                            <div class="row text-center mt-3">
                                <div class="col-4">
                                    <div class="h4 mb-1">${totalAttempts}</div>
                                    <small class="text-muted">–í—Å–µ–≥–æ –ø–æ–ø—ã—Ç–æ–∫</small>
                                </div>
                                <div class="col-4">
                                    <div class="h4 mb-1 text-success">${correctAnswers}</div>
                                    <small class="text-muted">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</small>
                                </div>
                                <div class="col-4">
                                    <div class="h4 mb-1 text-danger">${wrongAnswers}</div>
                                    <small class="text-muted">–û—à–∏–±–∫–∏</small>
                                </div>
                            </div>
                            <div class="mt-3">
                                <p>–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–ª–æ–≤: <strong>${totalWords}</strong></p>
                                <p>–°—Ä–µ–¥–Ω—è—è —Ç–æ—á–Ω–æ—Å—Ç—å: <strong>${totalAttempts > 0 ? Math.round((correctAnswers / totalAttempts) * 100) : 0}%</strong></p>
                                <p>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: <strong>${totalAttempts > 0 ? (totalAttempts / totalWords).toFixed(1) : 0} —Å–µ–∫/—Å–ª–æ–≤–æ</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-4">
                <a href="{% url 'exercises:my_exercises' %}" class="btn btn-primary me-2">
                    <i class="bi bi-list me-2"></i>–ö —Å–ø–∏—Å–∫—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
                </a>
                <a href="{% url 'dashboard:student' %}" class="btn btn-outline-primary">
                    <i class="bi bi-house me-2"></i>–í –∫–∞–±–∏–Ω–µ—Ç
                </a>
            </div>
        </div>
    `;

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
    completeExercise();
}

function updateStats() {
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    document.getElementById('total-attempts').textContent = totalAttempts;
    document.getElementById('correct-answers').textContent = correctAnswers;
    document.getElementById('wrong-answers').textContent = wrongAnswers;
}

function updateCurrentWordStats() {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–ª–æ–≤–∞
    const element = document.getElementById('current-word-attempts');
    if (element) {
        element.textContent = currentWordAttempts;
    }
}

function completeExercise() {
    const exerciseId = document.getElementById('exercise-id').value;

    fetch(`/exercises/complete/${exerciseId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ status: 'completed' })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            console.log('–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ');
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è:', error);
    });
}

function updateProgress() {
    if (totalWords === 0) return;
    const progress = ((currentIndex) / totalWords) * 100;
    const progressBar = document.getElementById('exercise-progress');
    if (progressBar) progressBar.style.width = progress + '%';
}

function updateWordCounter() {
    const currentWordBadge = document.getElementById('current-word');
    if (currentWordBadge) currentWordBadge.textContent = currentIndex + 1;
    const totalWordsBadge = document.getElementById('total-words');
    if (totalWordsBadge) totalWordsBadge.textContent = totalWords;
}

// ============= –ê–ù–ò–ú–ê–¶–ò–ò =============

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –∞–Ω–∏–º–∞—Ü–∏–π
function stopAllAnimations() {
    if (successAnimationInterval) {
        clearInterval(successAnimationInterval);
        successAnimationInterval = null;
    }
    if (failureAnimationInterval) {
        clearInterval(failureAnimationInterval);
        failureAnimationInterval = null;
    }
    if (successParticlesInterval) {
        clearInterval(successParticlesInterval);
        successParticlesInterval = null;
    }
    if (failureDropsInterval) {
        clearInterval(failureDropsInterval);
        failureDropsInterval = null;
    }

    // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å—ã –∞–Ω–∏–º–∞—Ü–∏–π
    document.body.classList.remove('success-animation', 'failure-animation');

    // –£–¥–∞–ª—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    document.querySelectorAll('.success-effect, .failure-effect, .confetti, .sad-face, .particle').forEach(el => {
        if (el.parentNode) {
            el.parentNode.removeChild(el);
        }
    });
}

// –ê–Ω–∏–º–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞ (—Ñ–µ–π–µ—Ä–≤–µ—Ä–∫)
function startSuccessAnimation() {
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ñ–æ–Ω–∞
    document.body.classList.add('success-animation');

    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
    const container = document.createElement('div');
    container.className = 'success-effect';
    container.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        overflow: hidden;
    `;
    document.body.appendChild(container);

    // –°–æ–∑–¥–∞–µ–º —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫ (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π)
    successAnimationInterval = setInterval(() => {
        createConfetti(container);
    }, 150);

    // –°–æ–∑–¥–∞–µ–º —á–∞—Å—Ç–∏—Ü—ã —É—Å–ø–µ—Ö–∞ –≤–æ–∫—Ä—É–≥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö drop-–∑–æ–Ω (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ)
    successParticlesInterval = setInterval(() => {
        const dropZones = document.querySelectorAll('.drop-zone.correct');
        dropZones.forEach(zone => {
            createSuccessParticle(zone);
        });
    }, 500);
}

// –°–æ–∑–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
function createConfetti(container) {
    const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff', '#ff8800', '#88ff00'];
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.cssText = `
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: ${colors[Math.floor(Math.random() * colors.length)]};
        top: -20px;
        left: ${Math.random() * 100}%;
        border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
        transform: rotate(${Math.random() * 360}deg);
        animation: confetti-fall ${2 + Math.random() * 2}s linear forwards;
        z-index: 9999;
    `;

    container.appendChild(confetti);

    // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
        if (confetti.parentNode) {
            confetti.parentNode.removeChild(confetti);
        }
    }, 4000);
}

// –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü —É—Å–ø–µ—Ö–∞ –≤–æ–∫—Ä—É–≥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∑–æ–Ω
function createSuccessParticle(zoneElement) {
    const rect = zoneElement.getBoundingClientRect();
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.cssText = `
        position: fixed;
        width: 6px;
        height: 6px;
        background-color: #4CAF50;
        border-radius: 50%;
        top: ${rect.top + rect.height / 2}px;
        left: ${rect.left + rect.width / 2}px;
        pointer-events: none;
        z-index: 9999;
        animation: success-particle 1.5s ease-out forwards;
        --tx: ${Math.random() * 100 - 50}px;
        --ty: ${Math.random() * 100 - 50}px;
    `;

    document.body.appendChild(particle);

    // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
        if (particle.parentNode) {
            particle.parentNode.removeChild(particle);
        }
    }, 1500);
}

// –ê–Ω–∏–º–∞—Ü–∏—è –Ω–µ—É–¥–∞—á–∏ (–≥—Ä—É—Å—Ç–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç)
function startFailureAnimation() {
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Ñ–æ–Ω–∞
    document.body.classList.add('failure-animation');

    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –Ω–µ—É–¥–∞—á–∏
    const container = document.createElement('div');
    container.className = 'failure-effect';
    container.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 9998;
        overflow: hidden;
    `;
    document.body.appendChild(container);

    // –°–æ–∑–¥–∞–µ–º –≥—Ä—É—Å—Ç–Ω—ã–µ —Å–º–∞–π–ª–∏–∫–∏ (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ)
    failureAnimationInterval = setInterval(() => {
        createSadFace(container);
    }, 800);

    // –°–æ–∑–¥–∞–µ–º –∫–∞–ø–ª–∏ "–¥–æ–∂–¥—è" –≤–æ–∫—Ä—É–≥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∑–æ–Ω (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ)
    failureDropsInterval = setInterval(() => {
        const dropZones = document.querySelectorAll('.drop-zone.incorrect');
        dropZones.forEach(zone => {
            createFailureDrop(zone);
        });
    }, 600);
}

// –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É—Å—Ç–Ω–æ–≥–æ —Å–º–∞–π–ª–∏–∫–∞
function createSadFace(container) {
    const sadFace = document.createElement('div');
    sadFace.className = 'sad-face';
    sadFace.innerHTML = 'üò¢';
    sadFace.style.cssText = `
        position: absolute;
        font-size: 2rem;
        top: -40px;
        left: ${Math.random() * 100}%;
        animation: sad-fall ${3 + Math.random() * 2}s ease-in forwards;
        z-index: 9999;
    `;

    container.appendChild(sadFace);

    // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
        if (sadFace.parentNode) {
            sadFace.parentNode.removeChild(sadFace);
        }
    }, 5000);
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–ø–ª–∏ –Ω–µ—É–¥–∞—á–∏ –≤–æ–∫—Ä—É–≥ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∑–æ–Ω
function createFailureDrop(zoneElement) {
    const rect = zoneElement.getBoundingClientRect();
    const drop = document.createElement('div');
    drop.className = 'particle';
    drop.style.cssText = `
        position: fixed;
        width: 4px;
        height: 4px;
        background-color: #ff4444;
        border-radius: 50%;
        top: ${rect.top}px;
        left: ${rect.left + rect.width / 2}px;
        pointer-events: none;
        z-index: 9999;
        animation: failure-drop 2s ease-out forwards;
    `;

    document.body.appendChild(drop);

    // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
        if (drop.parentNode) {
            drop.parentNode.removeChild(drop);
        }
    }, 2000);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
const checkBtn = document.getElementById('check-btn');
if (checkBtn) checkBtn.addEventListener('click', checkWord);
const resetBtn = document.getElementById('reset-btn');
if (resetBtn) resetBtn.addEventListener('click', resetWord);
const nextBtn = document.getElementById('next-btn');
if (nextBtn) nextBtn.addEventListener('click', nextWord);

// –ì–ª–æ–±–∞–ª—å–Ω—ã–π Enter
document.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        if (!document.getElementById('check-btn').classList.contains('d-none')) {
            checkWord();
        } else if (!document.getElementById('next-btn').classList.contains('d-none')) {
            nextWord();
        }
    }
});
</script>
{% endblock %}